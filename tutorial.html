<!DOCTYPE html>
<html lang="en">

<head>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html {
            min-width: 100%;
            min-height: 100%;
        }

        body {
            min-width: 100%;
            min-height: 100%;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lodash@latest/lodash.min.js"></script>

    <style>
        .design {
            position: relative;
            width: 1200px;
            height: 633px;
            margin: auto;
        }

        .design>* {
            position: absolute;
            height: 100%;
            width: 100%;
        }

        .blend>* {
            position: absolute;
            background-repeat: no-repeat;
        }

        /*

        */

        .blend>:first-child {
            background-image: linear-gradient(white, white), url(/img/png/screenshot-2020-12-28.png);
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            filter: blur(3px);
            background-size: 1200px 633px;
            background-blend-mode: saturation;
        }

        .stripe-1 {
            width: 1.5rem;
            height: 1.5rem;
            color: white;
            background: repeating-linear-gradient(-45deg,
                    white,
                    white 3px,
                    silver 3px,
                    silver 6px);
        }


        .blend>:last-child>div {
            position: absolute;
            bottom: 0;
            right: 0;
        }

        .blend>:last-child {
            border: 1px dotted gray;
            border-radius: 1rem;
            margin: -1px;
            background-image: url(/img/png/screenshot-2020-12-28.png);
            left: 0px;
            top: 0px;
            background-size: 1200px 633px;
            background-position-x: -0px;
            background-position-y: -0px;
            width: 200px;
            height: 200px;
        }
    </style>
</head>

<body id="tutorial">
    <div class="design">
        <div class="blend">
            <div>
            </div>

            <div id="item">
                <div class="stripe-1"></div>
            </div>
        </div>
    </div>
</body>

<script type="module">
</script>

<script>
    var dragItem = document.querySelector("#item");
    var dragItem2 = document.querySelector("#item>div");
    var container = document.querySelector("#tutorial");

    var active = false;
    var target;
    var currentX;
    var currentY;
    var initialX;
    var initialY;
    var xOffset = 0;
    var yOffset = 0;
    var cx = 200;
    var cy = 200;

    container.addEventListener("touchstart", dragStart, false);
    container.addEventListener("touchend", dragEnd, false);
    container.addEventListener("touchmove", drag, false);

    container.addEventListener("mousedown", dragStart, false);
    container.addEventListener("mouseup", dragEnd, false);
    container.addEventListener("mousemove", drag, false);

    function dragStart(e) {
        if (e.type === "touchstart") {
            initialX = e.touches[0].clientX - xOffset;
            initialY = e.touches[0].clientY - yOffset;
        } else {
            initialX = e.clientX - xOffset;
            initialY = e.clientY - yOffset;
        }

        if (e.target === dragItem || e.target === dragItem2) {
            target = e.target;

            active = true;
        }
    }

    function dragEnd(e) {
        initialX = currentX;
        initialY = currentY;

        cx = $(dragItem).width();
        cy = $(dragItem).height();

        console.log(cx, cy);

        active = false;
    }

    function drag(e) {
        if (active) {

            e.preventDefault();

            if (e.type === "touchmove") {
                currentX = e.touches[0].clientX - initialX;
                currentY = e.touches[0].clientY - initialY;
            } else {
                currentX = e.clientX - initialX;
                currentY = e.clientY - initialY;
            }
            if (target === dragItem) {
                xOffset = currentX;
                yOffset = currentY;

                setTranslate(currentX, currentY, dragItem);
            }

            if (target === dragItem2) {
                setDimension(currentX, currentY, dragItem);
            }
        }
    }

    function setTranslate(xPos, yPos, el) {
        // el.style.transform = "translate3d(" + xPos + "px, " + yPos + "px, 0)";
        const X = Math.min(1200 - cx, Math.max(0, (0 + xPos)));
        const Y = Math.min(633 - cy, Math.max(0, (0 + yPos)));
        $(el).css({
            "left": X + "px",
            "top": Y + "px",
            "background-position-x": "-" + X + "px",
            "background-position-y": "-" + Y + "px",
        });
    }

    function setDimension(xPos, yPos, el) {
        const pos = $(dragItem).position();
        let cx_ = cx + xPos - pos.left;
        let cy_ = cy + yPos - pos.top;
        console.log(cx_, xPos, cy_, yPos);
        $(el).css({
            "width": cx_ + "px",
            "height": cy_ + "px",
        });
    }
</script>

</html>