<!DOCTYPE html>
<html lang="en">
<!-- https://codepen.io/heymalice/pen/bWOYEj -->

<head>
    <link href="./pulse.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@latest/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html {
            position: relative;
            min-height: 100%;
        }

        body {
            margin-bottom: 60px;
            /* Margin bottom by footer height */
        }

        .footer {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 60px;
            /* Set the fixed height of the footer here */
            line-height: 60px;
            /* Vertically center the text there */
            background-color: #f5f5f5;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script>

</head>

<body>
    <main role="main" class="container">
        <h1>&hellip;</h1>
        <div class="box">
            <div class="object">
                <div class="outline">
                </div>
                <div class="outline" id="delayed">
                </div>
                <div class="button">
                </div>
                <div class="button" id="circlein">
                    <svg class="mic-icon" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1000 1000"
                        enable-background="new 0 0 1000 1000" xml:space="preserve" style="fill:#1E2D70">
                        <g>
                            <path
                                d="M500,683.8c84.6,0,153.1-68.6,153.1-153.1V163.1C653.1,78.6,584.6,10,500,10c-84.6,0-153.1,68.6-153.1,153.1v367.5C346.9,615.2,415.4,683.8,500,683.8z M714.4,438.8v91.9C714.4,649,618.4,745,500,745c-118.4,0-214.4-96-214.4-214.4v-91.9h-61.3v91.9c0,141.9,107.2,258.7,245,273.9v124.2H346.9V990h306.3v-61.3H530.6V804.5c137.8-15.2,245-132.1,245-273.9v-91.9H714.4z" />
                        </g>
                    </svg>
                </div>
            </div>
        </div>
    </main>
    <footer class="footer">
        <div class="container">
            <span class="text-muted"></span>
        </div>
    </footer>
</body>

<script type="text/javascript">
    function isString(x) {
        return Object.prototype.toString.call(x) === "[object String]"
    }
    function console_log(text) {
        console.log(text);
        if (isString(text)) $('footer div span').text(text);
    }
    $(document).ready(function () {
        function showStart() {
            $('.outline').css({
                color: 'blue',
                'animation': 'pulse 2s',
                'animation-timing-function': 'ease-out',
                'animation-iteration-count': 'infinite'
            });
            $('svg.mic-icon').css('fill', 'darkred');
            $('h1').html("&hellip;");
        }
        function showStop(error) {
            $('.outline').css({
                color: 'red',
                'animation': 'none'
            });
            $('svg.mic-icon').css('fill', '#1E2D70');
            if (error) $('h1').text(error);

        }
        var recognizing = false;
        function start() {
            recognition.start();
            showStart();
            console_log('Start ! Ready to receive a country command.');

        }
        function stop(error) {
            if (error) console.error(error);
            recognition.stop();
            showStop(error);
            console_log('Stop ');
        }


        // <!-- speech recognition : WORK IN PROGRESS -->
        var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
        var SpeechGrammarList = SpeechGrammarList || webkitSpeechGrammarList
        var SpeechRecognitionEvent = SpeechRecognitionEvent || webkitSpeechRecognitionEvent

        var grammar = '#JSGF V1.0; grammar colors; public <country> = ' + 'France | Italy' + ' ;'

        var recognition = new SpeechRecognition();
        var speechRecognitionList = new SpeechGrammarList();
        speechRecognitionList.addFromString(grammar, 1);
        recognition.grammars = speechRecognitionList;
        recognition.continuous = true;
        recognition.lang = 'fr-FR';
        recognition.interimResults = false;
        recognition.maxAlternatives = 1;
        //     recognition.lang = 'en-US';
        //     recognition.continuous = true;
        //     recognition.InterimResults = true;


        $('div.button#circlein').on("click", function () {
            try {
                start();
            } catch (error) {
                console_log(error);
                stop();
            }
        });

        recognition.onresult = function (event) {
            // The SpeechRecognitionEvent results property returns a SpeechRecognitionResultList object
            // The SpeechRecognitionResultList object contains SpeechRecognitionResult objects.
            // It has a getter so it can be accessed like an array
            // The first [0] returns the SpeechRecognitionResult at the last position.
            // Each SpeechRecognitionResult object contains SpeechRecognitionAlternative objects that contain individual results.
            // These also have getters so they can be accessed like arrays.
            // The second [0] returns the SpeechRecognitionAlternative at position 0.
            // We then return the transcript property of the SpeechRecognitionAlternative object
            $('h1').empty();
            for (var i = 0, l = event.results.length; i < l; i++) {
                var result = event.results[i][0].transcript;
                $('h1').append($('<p>').text(result));
                console_log(event.results[i]); // , 'Confidence: ' + event.results[i][0].confidence
                if (result.trim().startsWith('stop')) {
                    stop();
                }
            }
        }

        recognition.onspeechend = function () {
            stop();
        }

        recognition.onnomatch = function (event) {
            console_log("I didn't recognise that country.");
        }

        recognition.onerror = function (event) {
            console_log('Error occurred in recognition: ' + event.error);
        }
    });

</script>


</html>